
--source include/have_rocksdb.inc

--disable_warnings
DROP TABLE IF EXISTS t1, t2;
--enable_warnings

CREATE TABLE t1 (t1_b INT PRIMARY KEY);

# Try simple foreign key - should succeed as it is being supported in myrocks
CREATE TABLE t2 (t2_a INT PRIMARY KEY, t2_b INT NOT NULL, t2_c INT NOT NULL);
CREATE TABLE t3 (t3_a INT NOT NULL, t3_b INT NOT NULL, t3_c INT NOT NULL, FOREIGN KEY (t3_b) REFERENCES t2(t2_a) ON UPDATE CASCADE, FOREIGN KEY (t3_c) REFERENCES t1(t1_b));
#create table t3 (t3_a int primary key, t3_b int not null, t3_c int not null, foreign key(t3_b) references t2(t2_a) on update cascade, foreign key (t3_c) references t1(t1_b));
INSERT INTO t1 (t1_b) VALUES (100),(200),(300);
INSERT INTO t2 (t2_a,t2_b,t2_c) VALUES (1,100,1),(2,200,2),(3,300,3);
INSERT INTO t3 (t3_a, t3_b, t3_c) VALUES (1,1,100),(2,2,200),(3,3,300);

CREATE TABLE t4(t4_a INT NOT NULL, t4_b INT NOT NULL, FOREIGN KEY (t4_b) REFERENCES t1(t1_b) ON UPDATE CASCADE ON DELETE CASCADE);
INSERT INTO t4(t4_a, t4_b) VALUES (1,100),(2,200),(3,300);

#see result
SELECT * FROM INFORMATION_SCHEMA.ROCKSDB_FKINFO;

#clean up
DROP TABLE t4;
DROP TABLE t3;
DROP TABLE t2;
DROP TABLE t1;
